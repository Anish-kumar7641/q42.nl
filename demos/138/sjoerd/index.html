<html><head></head><body onload="start()" style="background: rgb(34, 34, 85) none repeat scroll 0%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">


<script>
var context;
var N = 10;
var IX = 1;
var IY = N;
var IZ = N*N;
var th = 5.5;
var scale = 400 / N;
var center = (N - 1) / 2;
var orbit = center * 2 / 3;
var radius = 0.50 * N;
var value = 0.15 * N * N;
var data = [], pointsX = [], pointsY = [], pointsZ = [];

function r(x1,y1,z1, x2,y2,z2)
{
  x1 -= x2; y1 -= y2; z1 -= z2;
  if (x1 < -radius || x1 > radius || y1 < -radius || y1 > radius || z1 < -radius || z1 > radius)
    return 0;
  return value / (x1*x1 + y1*y1 + z1*z1);
}

function point(f1, f2)
{
  return ((f1 < th && f2 >= th) || (f1 >= th && f2 < th)) && (f1 - th) / (f1 - f2);
}

var count = 0;
function draw(p1, p2, p3, p4)
{
  if (p1)
  {
    if (p2) line(p1, p2);
    if (p3) line(p1, p3);
    if (p4) line(p1, p4);
  }
  if (p2)
  {
    if (p3) line(p2, p3);
    if (p4) line(p2, p4);
  }
  if (p3 && p4)
    line(p3, p4)
}

function line(p1, p2)
{
  context.beginPath();
  context.moveTo(p1[0], p1[1]);
  context.lineTo(p2[0], p2[1]);
  context.closePath();
  context.stroke();
}

function to2d(x, y, z)
{
  z = z / 2;
  return [x + z, y - z];
}

function start()
{
  for (var i = 0; i < 2; i++)
  {
    var canvas = document.getElementsByTagName("canvas")[i];
    context = canvas.getContext("2d");
    context.strokeStyle = "#55d";
    context.lineWidth = 1 / scale;
    context.translate(0, 200);
    context.scale(scale, scale);
  }

  doIteration();
}

var d = 0;
function doIteration()
{
  var t0 = new Date();
  var canvas = document.getElementsByTagName("canvas")[0];
  context = canvas.getContext("2d");

  context.clearRect(-100, -100, 200, 200);
  var i = 0;
  var p1x = center + orbit * Math.sin(d) * Math.sin(d * 1.5);
  var p1y = center + orbit * Math.cos(d) * Math.sin(d * 1.5);
  var p1z = center + orbit * Math.sin(d) * Math.cos(d * 1.5);
  var p2x = center + orbit * Math.sin(d * 1.5 + 2) * Math.sin(d + 2);
  var p2y = center + orbit * Math.cos(d * 1.5 + 2) * Math.sin(d + 2);
  var p2z = center + orbit * Math.sin(d * 1.5 + 2) * Math.cos(d + 2);
  var p3x = center + orbit * Math.sin(d + 4) * Math.cos(d * 1.5);
  var p3y = center + orbit * Math.cos(d * 1.5 + 4) * Math.sin(d);
  var p3z = center + orbit * Math.sin(d + 4) * Math.sin(d * 1.5);
  for (var z = 0; z < N; z++)
    for (var y = 0; y < N; y++)
      for (var x = 0; x < N; x++)
        data[i++] = r(x,y,z, p1x,p1y,p1z) + r(x,y,z, p2x,p2y,p2z) + r(x,y,z, p3x,p3y,p3z);

  var i = 0, p;
  for (var z = 0; z < N - 1; z++)
  {
    for (var y = 0; y < N - 1; y++)
    {
      for (var x = 0; x < N - 1; x++)
      {
        p = point(data[i], data[i + IX]);
        pointsX[i] = p && to2d(x + p, y, z);
        p = point(data[i], data[i + IY]);
        pointsY[i] = p && to2d(x, y + p, z);
        p = point(data[i], data[i + IZ]);
        pointsZ[i] = p && to2d(x, y, z + p);
        i++;
      }
      i++;
    }
    i+=N;
  }

  i = 0;
  for (var z = 0; z < N - 1; z++)
  {
    for (var y = 0; y < N - 1; y++)
    {
      for (var x = 0; x < N - 1; x++)
      {
        draw(pointsX[i], pointsY[i], pointsX[i + IY], pointsY[i + IX]);
        draw(pointsX[i], pointsZ[i], pointsX[i + IZ], pointsZ[i + IX]);
        draw(pointsZ[i], pointsY[i], pointsZ[i + IY], pointsY[i + IZ]);
        i++;
      }
      i++;
    }
    i+=N;
  }

  document.body.appendChild(canvas);

  d -= 0.1;
  setTimeout(doIteration, 0);

  document.title = (new Date() - t0) + "ms";
}
</script><canvas width="600" height="600" style="background: rgb(34, 34, 85) none repeat scroll 0%; position: absolute; top: 10px; left: 10px; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;"></canvas><canvas width="600" height="600" style="background: rgb(34, 34, 85) none repeat scroll 0%; position: absolute; top: 10px; left: 10px; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;"></canvas></body></html>