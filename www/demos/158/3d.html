<html>

<!-- Mirrored from playground.q42.nl/animatie/3d.html by HTTrack Website Copier/3.x [XR&CO'2007], Thu, 20 Mar 2008 20:00:18 GMT -->
<head>
<style>div{width:0px;border:0px solid red;position:absolute;-moz-box-sizing:border-box}</style>
<script>
fog='000000';
size=16;
filled=[];hor=[];ver=[];
for (i=0;i<=size;i++) {
  hor[i]=[];
  ver[i]=[];
  filled[i]=1;
}
hor[0]=hor[size]=ver[0]=ver[size]=filled;
posh=posv=size/2;
ang=0.3;

for (i=0;i<200;i++) {
  var x=Math.floor(Math.random()*size);
  var y=Math.floor(Math.random()*size);
  hor[x][y]=1;
  ver[x][y]=1;
}

function init() {
  canvas=document.getElementById('canvasdiv');
  try{canvas.focus();}
  catch(e){}
  draw();
}
function hex(c) {
  var C=c.toString(16);
  if (C.length==1) C='0'+C;
  return C;
}
function wall(x,y,c,X,Y,C,bg) {
  d=0;
/*  if (c>255) c=255;if (C>255) C=255;
  if (c<0) c=0;if (C<0) C=0;
  if (c==255&&C==255) return '';*/
  if (y>Y) {a=y;y=Y;Y=a;d=1-d}
  if (x>X) {a=x;x=X;X=a;a=c;c=C;C=a;d=1-d}
  if (X<-200) return '';
  if (x>200) return '';
  if (X>200) {Y=y+(Y-y)*(200-x)/(X-x);X=200}
  if (x<-200) {y=Y+(y-Y)*(-200-X)/(x-X);x=-200}


  
//  c=C=(C+c)>>1;
//  c=hex(c);C=hex(C);
//  return '<div style="filter:progid:DXImageTransform.Microsoft.gradient(GradientType=1,startColorstr=#'+c+fog+', endColorstr=#'+C+fog+');background:'+bg+';width:'+(X-x)+';height:'+(2*Y)+'px;top:'+(150-Y)+'px;left:'+(200+x)+'px">'+
//  '<div style="filter:progid:DXImageTransform.Microsoft.Chroma(Color=#ff0000);border-'+(d?'left':'right')+':'+(X-x)+'px #ff0000 solid;border-top:'+(Y-y)+'px solid #'+fog+';border-bottom:'+(Y-y)+'px solid #'+fog+';height:100%"></div></div>';
  return '<div style="border-'+(d?'left':'right')+':'+(X-x)+'px '+bg+' solid;border-top:'+(Y-y)+'px solid #'+fog+';border-bottom:'+(Y-y)+'px solid #'+fog+';width:'+(X-x)+';height:'+(2*Y)+'px;top:'+(150-Y)+'px;left:'+(200+x)+'px"></div>';
}
function trace(h,v,a) {
  dh=Math.sin(a);dv=Math.cos(a);var d=0;
  var hit=false;
  while (!hit) {
    h1=h+dh;v1=v+dv;
    if (Math.floor(h1)!=Math.floor(h)) {
      return {d:d,c:(v1+v)/2}
    }
    if (Math.floor(h1)!=Math.floor(h)) {
      return {d:d,c:(v1+v)/2}
    }
  }
}

function getP(x,z) {
  return {
    x:Math.round(500*x/z),
    y:Math.round(500*0.3/z),
    c:Math.round(20*z-00)
  }
}

function draw() {
  s=Math.sin(ang);c=Math.cos(ang);var d=0;
//  fog=hex(Math.floor(128+c*120))+'0000';
//  status=fog;
  canvas.style.background='#'+fog;
  P=[];
  H='';
  for (h=0;h<=size;h++) {
    for (v=0;v<=size;v++) {
      if (hor[v][h]) {
        x=(h-posh)*s+(v-posv)*c;
        z=(h-posh)*c-(v-posv)*s;
        if (z<=0) continue;
        var p1=getP(x,z);
        x=(h+1-posh)*s+(v-posv)*c;
        z=(h+1-posh)*c-(v-posv)*s;
        if (z<=0) continue;
        var p2=getP(x,z);
        var C=(p1.c+p2.c)>>1;
        if (C<0) C=0;
        if (C>255) continue;
        P.push({p1:p1,p2:p2,c:C,bg:'#'+hex(255-C)+'0000'});
      }
      if (ver[h][v]) {
        x=(h-posh)*s+(v-posv)*c;
        z=(h-posh)*c-(v-posv)*s;
        if (z<=0) continue;
        var p1=getP(x,z);
        x=(h-posh)*s+(v+1-posv)*c;
        z=(h-posh)*c-(v+1-posv)*s;
        if (z<=0) continue;
        var p2=getP(x,z);
        var C=(p1.c+p2.c)>>1;
        if (C<0) C=0;
        if (C>255) continue;
        P.push({p1:p1,p2:p2,c:C,bg:'#0000'+hex(255-C)});
      }
    }
  }
  P.sort(function(a,b) {return b.c-a.c});
  window.status=P.length;
  for (i=0;i<P.length-1;i++) {
    Q=P[i].p1;R=P[i].p2;
    H+=wall(Q.x,Q.y,Q.c,R.x,R.y,R.c,P[i].bg);
  }
  canvas.innerHTML=H;
//  ang+=0.1;
  setTimeout("draw()",50);
//  alert(H);
}

function handle(evt) {
  switch(evt.keyCode||evt.which) {
    case 37: ang+=0.1; break;
    case 39: ang-=0.1; break;
    case 38: posh+=c/5; posv-=s/5; break;
    case 40: posh-=c/5; posv+=s/5; break;
  }
  return false
}
  
</script>
</head>
<body onload="init()" onkeydown="handle(event)">
<div id=canvasdiv style="overflow:hidden;width:400px;height:300px;">
</div>
<p style="padding-left:420px;">Use the arrow keys to move through the maze.</p>
</body>

<!-- Mirrored from playground.q42.nl/animatie/3d.html by HTTrack Website Copier/3.x [XR&CO'2007], Thu, 20 Mar 2008 20:00:18 GMT -->
</html>