<html>
<head>
  <title>Radiohead / House of Cards</title>
  <script src="data.js"></script>
  <style>
    body { background: #000000; text-align: center }
    canvas { width: 400px; height: 300px; background: #000000; cursor: move }
  </style>
</head>
<body>
  <canvas width="400" height="300" 
      onmousedown="doMouseDown(event)"
      onmousemove="doMouseMove(event)"
      onmouseup="doMouseUp(event)">
    You need a browser with canvas support
  </canvas>
</body>
<script>
var ctx = document.body.getElementsByTagName("canvas")[0].getContext("2d");
var colorF = function(i, p) { return Math.floor(1000 * Math.pow(i / 200 + 0.3, p))/10; }

var colors = [];
for (var i = 0; i < 256; i++)
  colors[i] = "rgb(" + colorF(i, 6) + "%, " + colorF(i, 2) + "%, " + colorF(i, 0.3) + "%)";

var theta = 0;
function draw()
{
  ctx.fillStyle = "rgba(0,0,0,0.2)";
  ctx.fillRect(0, 0, 400, 300);
  var pts = points[Math.floor(new Date / 200) % (points.length - 1)] || [];
  var prevColor = -1;
  var cos = Math.cos(theta);
  var sin = Math.sin(theta);
  var x0 = 200 + sin * 100 - 100 * cos;
  for (var i = 0; i < pts.length - 4; i+=4)
  {
    var color = pts[i+3];
    if (color < 40) continue;
    var x = (x0 + cos * pts[i+0] + sin * pts[i+2]);
    var y = (pts[i+1]);
    if (color != prevColor)
    {
      prevColor = color;
      ctx.fillStyle = colors[color];
    }
    ctx.fillRect(x, y, 1, 1);
  }
  setTimeout(draw, 0);
}

draw();

var mouseDown = false;
var startX = null;
var startTheta = null;
function doMouseDown(evt)
{
  mouseDown = true;
  startX = evt.clientX;
  startTheta = theta;
}

function doMouseUp(evt)
{
  mouseDown = false;
}

function doMouseMove(evt)
{
  if (mouseDown)
    theta = startTheta + (evt.clientX - startX) / 50;
}

</script>
